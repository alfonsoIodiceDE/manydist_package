"0","cat(""\\n=== DETAILED ANALYSIS OF OPTIMAL CLUSTERINGS ===\\n"")"
"1","\n=== DETAILED ANALYSIS OF OPTIMAL CLUSTERINGS ===\n"
"0","# Function to extract and analyze optimal clustering results"
"0","analyze_optimal_clustering <- function(optimal_row, clustering_evaluations, "
"0","                                       clustering_data, clustering_type) {"
"0","  "
"0","  cat(sprintf(""\\n--- Analyzing Optimal %s Clustering ---\\n"", "
"0","              tools::toTitleCase(clustering_type)))"
"0","  "
"0","  # Extract clustering details"
"0","  dist_method <- optimal_row$distance_method"
"0","  clust_method <- optimal_row$clustering_method"
"0","  k <- optimal_row$k"
"0","  "
"0","  cat(sprintf(""Distance Method: %s\\n"", dist_method))"
"0","  cat(sprintf(""Clustering Method: %s\\n"", clust_method))"
"0","  cat(sprintf(""Number of Clusters: %d\\n"", k))"
"0","  cat(sprintf(""Composite Index Score: %.3f\\n"", optimal_row$composite_index))"
"0","  "
"0","  # Get cluster labels"
"0","  cluster_labels <- clustering_evaluations[[dist_method]][[clustering_type]][[clust_method]][[paste0(""k_"", k)]]$labels"
"0","  "
"0","  # Add cluster labels to data"
"0","  analysis_data <- copy(clustering_data)"
"0","  analysis_data[, cluster := cluster_labels]"
"0","  "
"0","  # Cluster size analysis"
"0","  cluster_sizes <- table(cluster_labels)"
"0","  cat(sprintf(""\\nCluster Sizes:\\n""))"
"0","  for (i in 1:length(cluster_sizes)) {"
"0","    cat(sprintf(""  Cluster %d: %d students (%.1f%%)\\n"", "
"0","                as.numeric(names(cluster_sizes)[i]), "
"0","                cluster_sizes[i], "
"0","                100 * cluster_sizes[i] / sum(cluster_sizes)))"
"0","  }"
"0","  "
"0","  # Resilience rate by cluster"
"0","  if (""RESILIENT"" %in% names(analysis_data)) {"
"0","    resilience_by_cluster <- analysis_data[, .("
"0","      n_students = .N,"
"0","      n_resilient = sum(RESILIENT, na.rm = TRUE),"
"0","      resilience_rate = mean(RESILIENT, na.rm = TRUE)"
"0","    ), by = cluster]"
"0","    "
"0","    cat(sprintf(""\\nResilience Rates by Cluster:\\n""))"
"0","    for (i in 1:nrow(resilience_by_cluster)) {"
"0","      cat(sprintf(""  Cluster %d: %.1f%% resilient (%d/%d students)\\n"","
"0","                  resilience_by_cluster$cluster[i],"
"0","                  100 * resilience_by_cluster$resilience_rate[i],"
"0","                  resilience_by_cluster$n_resilient[i],"
"0","                  resilience_by_cluster$n_students[i]))"
"0","    }"
"0","  }"
"0","  "
"0","  # Achievement profiles by cluster"
"0","  achievement_vars <- c(""MATH_AVG"", ""READ_AVG"", ""SCIE_AVG"")"
"0","  available_achievement <- intersect(achievement_vars, names(analysis_data))"
"0","  "
"0","  if (length(available_achievement) > 0) {"
"0","    cat(sprintf(""\\nAchievement Profiles by Cluster:\\n""))"
"0","    "
"0","    achievement_summary <- analysis_data[, lapply(.SD, function(x) {"
"0","      c(mean = mean(x, na.rm = TRUE), sd = sd(x, na.rm = TRUE))"
"0","    }), .SDcols = available_achievement, by = cluster]"
"0","    "
"0","    print(achievement_summary)"
"0","  }"
"0","  "
"0","  # Return analysis data for further investigation"
"0","  return(list("
"0","    data = analysis_data,"
"0","    cluster_sizes = cluster_sizes,"
"0","    optimal_params = list("
"0","      distance_method = dist_method,"
"0","      clustering_method = clust_method,"
"0","      k = k,"
"0","      composite_score = optimal_row$composite_index"
"0","    )"
"0","  ))"
"0","}"
"0",""
"0","# Analyze optimal macro clustering"
"0","optimal_macro_analysis <- analyze_optimal_clustering("
"0","  best_macro, clustering_evaluations, clustering_data, ""macro"""
"0",")"
"1","\n--- Analyzing Optimal Macro Clustering ---\n"
"1","Distance Method: unbiased_dependent\n"
"1","Clustering Method: single_linkage\n"
"1","Number of Clusters: 3\n"
"1","Composite Index Score: 0.354\n"
"1","\nCluster Sizes:\n"
"1","  Cluster 1: 4524 students (99.6%)\n"
"1","  Cluster 2: 18 students (0.4%)\n"
"1","  Cluster 3: 1 students (0.0%)\n"
"1","\nResilience Rates by Cluster:\n"
"1","  Cluster 1: 10.9% resilient (494/4524 students)\n"
"1","  Cluster 2: 50.0% resilient (9/18 students)\n"
"1","  Cluster 3: 0.0% resilient (0/1 students)\n"
"1","\nAchievement Profiles by Cluster:\n"
