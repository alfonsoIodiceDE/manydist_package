"0","# Enhanced cluster profiling function"
"0","interpret_macro_clusters <- function(cycle_name, k_value = 8) {"
"0","  "
"0","  # Get the clustering results for the specified cycle and k"
"0","  cluster_labels <- all_cycle_clustering_results[[cycle_name]]$macro[[""unbiased_independent""]][[""ward""]][[paste0(""k_"", k_value)]]$labels"
"0","  "
"0","  # Get the original data"
"0","  cycle_data <- cycle_prepared_data[[cycle_name]]$data"
"0","  "
"0","  # Add cluster assignments"
"0","  analysis_data <- copy(cycle_data)"
"0","  analysis_data[, CLUSTER := cluster_labels]"
"0","  "
"0","  # Comprehensive variable set for profiling"
"0","  profile_vars <- intersect(c("
"0","    # Achievement domains"
"0","    ""MATH_AVG"", ""READ_AVG"", ""SCIE_AVG"","
"0","    "
"0","    # Socioeconomic factors"
"0","    ""ESCS"", ""HISEI"", ""PAREDINT"", ""HOMEPOS"","
"0","    "
"0","    # Demographics"
"0","    ""ST004D01T"", ""GRADE"", ""IMMIG"", ""REPEAT"", ""LANGN"","
"0","    "
"0","    # Psychological factors"
"0","    ""ANXMAT"", ""BELONG"", ""TEACHSUP"","
"0","    "
"0","    # School context"
"0","    ""SCHSIZE"", ""SCHLTYPE"", ""STRATIO"", ""STAFFSHORT"", ""EDUSHORT"","
"0","    "
"0","    # Outcome"
"0","    ""RESILIENT"""
"0","  ), names(analysis_data))"
"0","  "
"0","  # Create comprehensive cluster profiles"
"0","  cluster_profiles <- analysis_data[, c("
"0","    # Calculate means for numeric variables"
"0","    lapply(.SD[, ..profile_vars], function(x) {"
"0","      if (is.numeric(x)) {"
"0","        round(mean(x, na.rm = TRUE), 3)"
"0","      } else {"
"0","        # For categorical, get the mode (most frequent category)"
"0","        tbl <- table(x)"
"0","        names(tbl)[which.max(tbl)]"
"0","      }"
"0","    }),"
"0","    # Additional summary statistics"
"0","    list("
"0","      n_students = .N,"
"0","      resilience_rate = round(mean(RESILIENT, na.rm = TRUE), 3),"
"0","      pop_weight = round(sum(W_FSTUWT, na.rm = TRUE), 0)"
"0","    )"
"0","  ), by = CLUSTER]"
"0","  "
"0","  # Sort by cluster number"
"0","  cluster_profiles <- cluster_profiles[order(CLUSTER)]"
"0","  "
"0","  cat(""=== MACRO CLUSTER PROFILES FOR"", cycle_name, ""(K=8) ===\n"")"
"0","  print(cluster_profiles)"
"0","  "
"0","  return(cluster_profiles)"
"0","}"
"0",""
"0","# Get profiles for all cycles"
"0","profiles_2015 <- interpret_macro_clusters(""2015"")"
"1","=== MACRO CLUSTER PROFILES FOR"
"1"," "
"1","2015"
"1"," "
"1","(K=8) ===
"
