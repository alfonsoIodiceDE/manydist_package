"0","cat(""\n=== CYCLE-SPECIFIC VARIABLE SELECTION ===\n"")"
"1","
=== CYCLE-SPECIFIC VARIABLE SELECTION ===
"
"0","identify_cycle_variables <- function(cycle_data, cycle_name) {"
"0","  cat(sprintf(""→ Variable analysis for PISA %s...\n"", cycle_name))"
"0","  "
"0","  all_available_vars <- names(cycle_data)"
"0","  cat(sprintf(""  Total variables in dataset: %d\n"", length(all_available_vars)))"
"0","  "
"0","  core_vars <- c(""ESCS"")"
"0","  "
"0","  extended_vars <- list("
"0","    ses_background = c(""HISEI"", ""PAREDINT"", ""HOMEPOS"", ""ICTRES"", ""CULTPOSS"", ""HEDRES"", ""WEALTH""),"
"0","    demographics = c(""ST004D01T"", ""IMMIG"", ""REPEAT""),"
"0","    motivation = c(""ANXMAT"", ""MATHEFF"", ""MATHMOT"", ""MATHPERS"", ""SCIEEFF"", ""JOYSCIE"", ""INTMAT"", "
"0","                   ""JOYREAD"", ""WORKMAST"", ""MASTGOAL"", ""GFOFAIL"", ""COMPETE"", ""MOTIVAT""),"
"0","    psychological = c(""PERSEVAGR"", ""GROSAGR"", ""STRESAGR"", ""EMOCOAGR"", ""CURIOAGR"", ""COOPAGR"", "
"0","                      ""EMPATAGR"", ""ASSERAGR"", ""METASUM"", ""ADAPTIVITY"", ""GCSELFEFF""),"
"0","    learning_behavior = c(""STUDYHMW"", ""EXERPRAC"", ""WORKPAY"", ""WORKHOME"", ""SKIPPING"", ""TARDYSD"","
"0","                          ""PERFEED"", ""DISCLIM"", ""COGACRCO"", ""COGACMCO"", ""EXPOFA"", ""EXPO21ST""),"
"0","    social_emotional = c(""BELONG"", ""TEACHSUP"", ""RELATST"", ""BULLIED"", ""FEELSAFE"", ""FAMSUP"", "
"0","                         ""CURSUPP"", ""EMOSUPS"", ""SOCCON"", ""SOCONPA""),"
"0","    wellbeing = c(""LIFESAT"", ""PSYCHSYM"", ""BODYIMA"", ""ATTSCHL"", ""EXPWB""),"
"0","    school_context = c(""CLSIZE"", ""MCLSIZE"", ""SCHSIZE"", ""SCHLTYPE"", ""STRATIO"", ""SMRATIO"", "
"0","                       ""STAFFSHORT"", ""EDUSHORT"", ""RATCMP1"", ""RATCMP2"", ""STUBEHA"", ""TEACHBEHA"","
"0","                       ""NEGSCLIM"", ""ENCOURPG"", ""EDULEAD"", ""INSTLEAD"", ""TCHPART""),"
"0","    ict_usage = c(""ICTRES"", ""ICTSCH"", ""ICTHOME"", ""ICTQUAL"", ""ICTSUBJ"", ""ICTENQ"", "
"0","                  ""ICTFEED"", ""ICTOUT"", ""ICTEFFIC""),"
"0","    creativity = c(""CREATEFF"", ""CREATSCH"", ""CREATFAM"", ""CREATAS"", ""CREATOOS"", "
"0","                   ""CREATOP"", ""OPENART"", ""IMAGINE"")"
"0","  )"
"0","  "
"0","  # Pattern-based discovery"
"0","  educational_patterns <- c(""TEACH"", ""ANXI"", ""EFFI"", ""JOY"", ""MOTI"", ""BELON"", ""STRESS"", ""EMO"")"
"0","  pattern_vars <- character(0)"
"0","  for (pattern in educational_patterns) {"
"0","    pattern_matches <- all_available_vars[grepl(pattern, all_available_vars, ignore.case = TRUE)]"
"0","    pattern_vars <- c(pattern_vars, pattern_matches)"
"0","  }"
"0","  "
"0","  exclude_patterns <- c(""^PV[0-9]"", ""^W_"", ""^CNT"", ""ID$"", ""^ST00[0-9]Q[0-9][0-9]"", ""FLAG"", ""ADMIN"", ""^PA"", ""^TC"")"
"0","  for (exclude_pattern in exclude_patterns) {"
"0","    pattern_vars <- pattern_vars[!grepl(exclude_pattern, pattern_vars)]"
"0","  }"
"0","  extended_vars$pattern_based <- unique(pattern_vars)"
"0","  "
"0","  available_vars <- all_available_vars"
"0","  cycle_clustering_vars <- core_vars[core_vars %in% available_vars]"
"0","  "
"0","  cat(""\n  Category analysis:\n"")"
"0","  for (category in names(extended_vars)) {"
"0","    category_vars <- extended_vars[[category]]"
"0","    available_category_vars <- intersect(category_vars, available_vars)"
"0","    "
"0","    coverage <- if(length(category_vars) > 0) length(available_category_vars) / length(category_vars) else 0"
"0","    include_category <- if(category == ""pattern_based"") {"
"0","      length(available_category_vars) > 0"
"0","    } else {"
"0","      coverage >= 0.2"
"0","    }"
"0","    "
"0","    if (include_category) {"
"0","      cycle_clustering_vars <- c(cycle_clustering_vars, available_category_vars)"
"0","      status_symbol <- ""✓"""
"0","    } else {"
"0","      status_symbol <- ""✗"""
"0","    }"
"0","    "
"0","    cat(sprintf(""    %s %s: %d/%d variables (%.1f%% coverage)\n"", "
"0","                status_symbol, category, "
"0","                length(available_category_vars), length(category_vars), coverage * 100))"
"0","  }"
"0","  "
"0","  cycle_clustering_vars <- unique(cycle_clustering_vars)"
"0","  "
"0","  # Remove achievement variables"
"0","  achievement_vars <- c(""MATH_AVG"", ""READ_AVG"", ""SCIE_AVG"", ""ACHIEVEMENT_OVERALL"")"
"0","  cycle_clustering_vars <- setdiff(cycle_clustering_vars, achievement_vars)"
"0","  "
"0","  suspected_categorical <- cycle_clustering_vars[grepl(""^ST[0-9].*Q[0-9]|IMMIG|SCHLTYPE|REPEAT|SKIP|TARDY|GENDER|CNT$"", cycle_clustering_vars)]"
"0","  suspected_continuous <- setdiff(cycle_clustering_vars, suspected_categorical)"
"0","  "
"0","  cat(sprintf(""\n✓ Selected %d clustering variables for PISA %s\n"", "
"0","              length(cycle_clustering_vars), cycle_name))"
"0","  cat(sprintf(""  → Estimated: %d continuous, %d categorical\n"", "
"0","              length(suspected_continuous), length(suspected_categorical)))"
"0","  "
"0","  return(list("
"0","    clustering_vars = cycle_clustering_vars,"
"0","    suspected_categorical = suspected_categorical,"
"0","    suspected_continuous = suspected_continuous,"
"0","    total_available = length(all_available_vars)"
"0","  ))"
"0","}"
"0",""
"0","cycle_variable_analysis <- list()"
"0","for (cycle_name in names(processed_list)) {"
"0","  if (!is.null(processed_list[[cycle_name]])) {"
"0","    cycle_variable_analysis[[cycle_name]] <- identify_cycle_variables("
"0","      processed_list[[cycle_name]]$data, cycle_name"
"0","    )"
"0","  }"
"0","}"
"1","→ Variable analysis for PISA 2015...
"
"1","  Total variables in dataset: 64
"
"1","
  Category analysis:
"
"1","    ✓ ses_background: 5/7 variables (71.4% coverage)
"
"1","    ✓ demographics: 3/3 variables (100.0% coverage)
"
"1","    ✓ motivation: 3/13 variables (23.1% coverage)
"
"1","    ✗ psychological: 0/11 variables (0.0% coverage)
"
"1","    ✗ learning_behavior: 1/12 variables (8.3% coverage)
"
"1","    ✓ social_emotional: 4/10 variables (40.0% coverage)
"
"1","    ✗ wellbeing: 0/5 variables (0.0% coverage)
"
"1","    ✓ school_context: 10/17 variables (58.8% coverage)
"
"1","    ✗ ict_usage: 1/9 variables (11.1% coverage)
"
"1","    ✗ creativity: 0/8 variables (0.0% coverage)
"
"1","    ✓ pattern_based: 7/7 variables (100.0% coverage)
"
"1","
✓ Selected 27 clustering variables for PISA 2015
"
"1","  → Estimated: 24 continuous, 3 categorical
"
"1","→ Variable analysis for PISA 2018...
"
"1","  Total variables in dataset: 65
"
"1","
  Category analysis:
"
"1","    ✓ ses_background: 6/7 variables (85.7% coverage)
"
"1","    ✓ demographics: 3/3 variables (100.0% coverage)
"
"1","    ✓ motivation: 5/13 variables (38.5% coverage)
"
"1","    ✓ psychological: 3/11 variables (27.3% coverage)
"
"1","    ✗ learning_behavior: 1/12 variables (8.3% coverage)
"
"1","    ✓ social_emotional: 5/10 variables (50.0% coverage)
"
"1","    ✓ wellbeing: 1/5 variables (20.0% coverage)
"
"1","    ✓ school_context: 10/17 variables (58.8% coverage)
"
"1","    ✗ ict_usage: 1/9 variables (11.1% coverage)
"
"1","    ✗ creativity: 0/8 variables (0.0% coverage)
"
"1","    ✓ pattern_based: 5/5 variables (100.0% coverage)
"
"1","
✓ Selected 34 clustering variables for PISA 2018
"
"1","  → Estimated: 31 continuous, 3 categorical
"
"1","→ Variable analysis for PISA 2022...
"
"1","  Total variables in dataset: 75
"
"1","
  Category analysis:
"
"1","    ✓ ses_background: 4/7 variables (57.1% coverage)
"
"1","    ✓ demographics: 3/3 variables (100.0% coverage)
"
"1","    ✓ motivation: 3/13 variables (23.1% coverage)
"
"1","    ✓ psychological: 8/11 variables (72.7% coverage)
"
"1","    ✓ learning_behavior: 10/12 variables (83.3% coverage)
"
"1","    ✓ social_emotional: 9/10 variables (90.0% coverage)
"
"1","    ✓ wellbeing: 4/5 variables (80.0% coverage)
"
"1","    ✓ school_context: 14/17 variables (82.4% coverage)
"
"1","    ✗ ict_usage: 1/9 variables (11.1% coverage)
"
"1","    ✗ creativity: 0/8 variables (0.0% coverage)
"
"1","    ✓ pattern_based: 4/4 variables (100.0% coverage)
"
"1","
✓ Selected 56 clustering variables for PISA 2022
"
"1","  → Estimated: 51 continuous, 5 categorical
"
"0","cat(""\n✓ Variable analysis completed for all cycles\n"")"
"1","
✓ Variable analysis completed for all cycles
"
