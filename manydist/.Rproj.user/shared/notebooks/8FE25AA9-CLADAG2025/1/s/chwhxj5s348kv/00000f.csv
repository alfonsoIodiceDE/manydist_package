"0","# ---- Load All PISA Cycles with Harmonization ----"
"0","cat(""Loading PISA data for all cycles...\n"")"
"1","Loading PISA data for all cycles...
"
"0","all_student_vars <- unlist(core_student_vars, use.names = FALSE)"
"0","all_school_vars <- unlist(core_school_vars, use.names = FALSE)"
"0","pisa_student_list <- list()"
"0","pisa_school_list <- list()"
"0",""
"0","for (cycle_name in names(pisa_cycles)) {"
"0","  cycle_info <- pisa_cycles[[cycle_name]]"
"0","  cat(""\n--- Loading PISA"", cycle_info$year, ""---\n"")"
"0","  "
"0","  stu_file <- path(cycle_info$student_file)"
"0","  stu_data <- safe_read_pisa_with_mapping("
"0","    stu_file, all_student_vars, cycle_info$var_mapping$student,"
"0","    target_countries, cycle_info$year"
"0","  )"
"0","  if (!is.null(stu_data) && nrow(stu_data) > 0) {"
"0","    pisa_student_list[[cycle_name]] <- stu_data"
"0","    cat(""Students loaded:"", nrow(stu_data), ""\n"")"
"0","  }"
"0","  "
"0","  sch_file <- path(cycle_info$school_file)"
"0","  sch_data <- safe_read_pisa_with_mapping("
"0","    sch_file, all_school_vars, cycle_info$var_mapping$school,"
"0","    target_countries, cycle_info$year"
"0","  )"
"0","  if (!is.null(sch_data) && nrow(sch_data) > 0) {"
"0","    pisa_school_list[[cycle_name]] <- sch_data"
"0","    cat(""Schools loaded:"", nrow(sch_data), ""\n"")"
"0","  }"
"0","}"
"1","
--- Loading PISA"
"1"," "
"1","2015"
"1"," "
"1","---
"
"1","Cycle"
"1"," "
"1","2015"
"1"," "
"1","- Missing variables:"
"1"," "
"1","MATHEFF, INTMAT, GRWTHMND, WORKMAST, RESILIENCE, MASTGOAL, GFOFAIL, COMPETE, PERSEV, TRUANCY, HOMWRK, DISCLIMA, DIRINS, PEERREL, BULLIED, FAMSUP, RELATST, PERCOMP, PERCOOP, TEACHINT, LIFESAT, EUDMO, WELLBEING, ATTSCHL, EXPDEG, PHYSACT, SCHWELL"
"1"," "
"1","
"
"1","Students loaded:"
"1"," "
"1","5532"
"1"," "
"1","
"
"1","Schools loaded:"
"1"," "
"1","211"
"1"," "
"1","
"
"1","
--- Loading PISA"
"1"," "
"1","2018"
"1"," "
"1","---
"
"1","Cycle"
"1"," "
"1","2018"
"1"," "
"1","- Missing variables:"
"1"," "
"1","ANXMAT, MATHMOT, MATHEFF, SCIEEFF, JOYSCIE, INTMAT, GRWTHMND, PERSEV, TRUANCY, HOMWRK, OUTHOURS, PEERREL, BULLIED, FAMSUP, RELATST, LIFESAT, WELLBEING, ATTSCHL, EXPDEG, PHYSACT, SCHWELL"
"1"," "
"1","
"
"1","Students loaded:"
"1"," "
"1","6403"
"1"," "
"1","
"
"1","Schools loaded:"
"1"," "
"1","242"
"1"," "
"1","
"
"1","
--- Loading PISA"
"1"," "
"1","2022"
"1"," "
"1","---
"
"1","Cycle"
"1"," "
"1","2022"
"1"," "
"1","- Missing variables:"
"1"," "
"1","SCIEEFF, JOYSCIE, INTMAT, GRWTHMND, WORKMAST, RESILIENCE, MASTGOAL, GFOFAIL, COMPETE, PERSEV, TRUANCY, HOMWRK, DISCLIMA, DIRINS, PERFEED, OUTHOURS, PEERREL, EMOSUPS, PERCOMP, PERCOOP, TEACHINT, EUDMO, WELLBEING, ATTSCHL, EXPDEG, PHYSACT, SCHWELL"
"1"," "
"1","
"
"1","Students loaded:"
"1"," "
"1","6403"
"1"," "
"1","
"
"1","Schools loaded:"
"1"," "
"1","230"
"1"," "
"1","
"
"0","# Harmonize variables across cycles"
"0","if (length(pisa_student_list) > 0) {"
"0","  all_student_vars_by_cycle <- lapply(pisa_student_list, names)"
"0","  common_student_vars <- Reduce(intersect, all_student_vars_by_cycle)"
"0","  cat(""\nCommon student variables across cycles:"", length(common_student_vars), ""\n"")"
"0","}"
"1","
Common student variables across cycles:"
"1"," "
"1","47"
"1"," "
"1","
"
"0","if (length(pisa_school_list) > 0) {"
"0","  all_school_vars_by_cycle <- lapply(pisa_school_list, names)"
"0","  common_school_vars <- Reduce(intersect, all_school_vars_by_cycle)"
"0","  cat(""Common school variables across cycles:"", length(common_school_vars), ""\n"")"
"0","}"
"1","Common school variables across cycles:"
"1"," "
"1","10"
"1"," "
"1","
"
